{% extends "base.html" %}

{% block title %}Assign Products to {{ location.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-body p-4 p-md-5">
            <h2 class="card-title mb-2">Assign Products to: <span class="text-primary">{{ location.name }}</span></h2>
            <p class="text-muted mb-4">Select the products that should appear on the count sheet for this location.</p>

            {# MODIFIED: Pass all_product_types explicitly to include #}
            {% include '_filter_bar.html' with context %} {# 'with context' is often good practice #}

            <form action="{{ url_for('assign_products', location_id=location.id) }}" method="POST">
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="assignProductsTable">
                        <thead class="table-dark">
                            <tr>
                                <th style="width: 10%;">Assign?</th>
                                <th class="product-name-header">Product Name</th>
                                <th class="product-type-header">Product Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in products %}
                            <tr class="product-row">
                                <td>
                                    <div class="form-check d-flex justify-content-center">
                                        <input class="form-check-input" type="checkbox" name="product_ids" value="{{ product.id }}" id="product_{{ product.id }}"
                                               {% if product.id in assigned_product_ids %}checked{% endif %} style="transform: scale(1.5);">
                                    </div>
                                </td>
                                <td><label for="product_{{ product.id }}" class="fw-bold product-name">{{ product.name }}</label></td>
                                <td class="product-type">{{ product.type }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                    <a href="{{ url_for('manage_locations') }}" class="btn btn-secondary me-md-2">Cancel</a>
                    <button type="submit" class="btn btn-primary">Save Assignments</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        initializeTableFilters('product-search', 'type-filter', '#assignProductsTable tbody');
    });
</script>
{% endblock scripts %}
{% endblock %}